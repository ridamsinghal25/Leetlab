<Card className="border shadow-lg ">
          <CardHeader className="border-b">
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
              <div className="flex items-center gap-2">
                <FileText className="h-6 w-6 text-primary" />
                <CardTitle className="text-2xl">Create Problem</CardTitle>
              </div>

              <div className="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                <Tabs
                  defaultValue="DP"
                  className="w-full sm:w-auto"
                  onValueChange={(value) => setSampleType(value)}
                >
                  <TabsList className="grid w-full grid-cols-2">
                    <TabsTrigger value="DP">DP Problem</TabsTrigger>
                    <TabsTrigger value="string">String Problem</TabsTrigger>
                  </TabsList>
                </Tabs>

                <Button
                  variant="outline"
                  className="gap-2"
                  onClick={loadSampleData}
                >
                  <Download className="h-4 w-4" />
                  Load Sample
                </Button>
              </div>
            </div>
          </CardHeader>

          <CardContent className="pt-6">
            <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
              {/* Basic Information */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="md:col-span-2 space-y-2">
                  <Label htmlFor="title" className="text-base font-medium">
                    Title
                  </Label>
                  <Input
                    id="title"
                    {...register("title")}
                    placeholder="Enter problem title"
                    className="text-base"
                  />
                  {errors.title && (
                    <p className="text-sm text-destructive">
                      {errors.title.message}
                    </p>
                  )}
                </div>

                <div className="md:col-span-2 space-y-2">
                  <Label
                    htmlFor="description"
                    className="text-base font-medium"
                  >
                    Description
                  </Label>
                  <Textarea
                    id="description"
                    {...register("description")}
                    placeholder="Enter problem description"
                    className="min-h-32 text-base resize-y"
                  />
                  {errors.description && (
                    <p className="text-sm text-destructive">
                      {errors.description.message}
                    </p>
                  )}
                </div>

                <div className="space-y-2">
                  <Label htmlFor="difficulty" className="text-base font-medium">
                    Difficulty
                  </Label>
                  <Select defaultValue="EASY" {...register("difficulty")}>
                    <SelectTrigger>
                      <SelectValue placeholder="Select difficulty" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="EASY">Easy</SelectItem>
                      <SelectItem value="MEDIUM">Medium</SelectItem>
                      <SelectItem value="HARD">Hard</SelectItem>
                    </SelectContent>
                  </Select>
                  {errors.difficulty && (
                    <p className="text-sm text-destructive">
                      {errors.difficulty.message}
                    </p>
                  )}
                </div>
              </div>

              {/* Tags */}
              <Card>
                <CardHeader className="pb-3">
                  <div className="flex items-center justify-between">
                    <CardTitle className="text-lg flex items-center gap-2">
                      <BookOpen className="h-5 w-5" />
                      Tags
                    </CardTitle>
                    <Button
                      type="button"
                      size="sm"
                      onClick={() => appendTag("")}
                    >
                      <Plus className="h-4 w-4 mr-1" /> Add Tag
                    </Button>
                  </div>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {tagFields.map((field, index) => (
                      <div key={field.id} className="flex gap-2 items-center">
                        <Input
                          {...register(`tags.${index}`)}
                          placeholder="Enter tag"
                          className="flex-1"
                        />
                        <Button
                          type="button"
                          variant="ghost"
                          size="icon"
                          onClick={() => removeTag(index)}
                          disabled={tagFields.length === 1}
                          className="text-destructive hover:text-destructive/90"
                        >
                          <Trash2 className="h-4 w-4" />
                        </Button>
                      </div>
                    ))}
                  </div>
                  {errors.tags && (
                    <p className="text-sm text-destructive mt-2">
                      {errors.tags.message}
                    </p>
                  )}
                </CardContent>
              </Card>

              {/* Test Cases */}
              <Card>
                <CardHeader className="pb-3">
                  <div className="flex items-center justify-between">
                    <CardTitle className="text-lg flex items-center gap-2">
                      <CheckCircle2 className="h-5 w-5" />
                      Test Cases
                    </CardTitle>
                    <Button
                      type="button"
                      size="sm"
                      onClick={() => appendTestCase({ input: "", output: "" })}
                    >
                      <Plus className="h-4 w-4 mr-1" /> Add Test Case
                    </Button>
                  </div>
                </CardHeader>
                <CardContent>
                  <Accordion type="multiple" className="space-y-4">
                    {testCaseFields.map((field, index) => (
                      <AccordionItem
                        key={field.id}
                        value={`test-case-${index}`}
                        className="border rounded-lg shadow-sm"
                      >
                        <AccordionTrigger className="px-4 py-3 hover:no-underline">
                          <div className="flex justify-between items-center w-full">
                            <span className="font-medium">
                              Test Case #{index + 1}
                            </span>
                            {index > 0 && (
                              <Button
                                type="button"
                                variant="ghost"
                                size="sm"
                                onClick={(e) => {
                                  e.stopPropagation();
                                  removeTestCase(index);
                                }}
                                className="text-destructive hover:text-destructive/90 h-8"
                              >
                                <Trash2 className="h-4 w-4 mr-1" /> Remove
                              </Button>
                            )}
                          </div>
                        </AccordionTrigger>
                        <AccordionContent className="px-4 pb-4">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label
                                htmlFor={`test-input-${index}`}
                                className="font-medium"
                              >
                                Input
                              </Label>
                              <Textarea
                                id={`test-input-${index}`}
                                {...register(`testCases.${index}.input`)}
                                placeholder="Enter test case input"
                                className="min-h-24 resize-y"
                              />
                              {errors.testCases?.[index]?.input && (
                                <p className="text-sm text-destructive">
                                  {errors.testCases[index].input.message}
                                </p>
                              )}
                            </div>
                            <div className="space-y-2">
                              <Label
                                htmlFor={`test-output-${index}`}
                                className="font-medium"
                              >
                                Expected Output
                              </Label>
                              <Textarea
                                id={`test-output-${index}`}
                                {...register(`testCases.${index}.output`)}
                                placeholder="Enter expected output"
                                className="min-h-24 resize-y"
                              />
                              {errors.testCases?.[index]?.output && (
                                <p className="text-sm text-destructive">
                                  {errors.testCases[index].output.message}
                                </p>
                              )}
                            </div>
                          </div>
                        </AccordionContent>
                      </AccordionItem>
                    ))}
                  </Accordion>
                  {errors.testCases && !Array.isArray(errors.testCases) && (
                    <p className="text-sm text-destructive mt-2">
                      {errors.testCases.message}
                    </p>
                  )}
                </CardContent>
              </Card>

              {/* Code Editor Sections */}
              <Tabs defaultValue="JAVASCRIPT" className="w-full">
                <TabsList className="grid grid-cols-3 mb-4">
                  <TabsTrigger value="JAVASCRIPT">JavaScript</TabsTrigger>
                  <TabsTrigger value="PYTHON">Python</TabsTrigger>
                  <TabsTrigger value="JAVA">Java</TabsTrigger>
                </TabsList>

                {["JAVASCRIPT", "PYTHON", "JAVA"].map((language) => (
                  <TabsContent key={language} value={language} className="mt-0">
                    <Card>
                      <CardHeader>
                        <CardTitle className="text-lg flex items-center gap-2">
                          <Code2 className="h-5 w-5" />
                          {language === "JAVASCRIPT"
                            ? "JavaScript"
                            : language === "PYTHON"
                            ? "Python"
                            : "Java"}
                        </CardTitle>
                      </CardHeader>
                      <CardContent className="space-y-6">
                        {/* Starter Code */}
                        <div className="space-y-3">
                          <Label className="text-base font-medium">
                            Starter Code Template
                          </Label>
                          <div className="border rounded-md overflow-hidden">
                            <Controller
                              name={`codeSnippets.${language}`}
                              control={control}
                              render={({ field }) => (
                                <Editor
                                  height="300px"
                                  language={language.toLowerCase()}
                                  theme="vs-dark"
                                  value={field.value}
                                  onChange={field.onChange}
                                  options={{
                                    minimap: { enabled: false },
                                    fontSize: 14,
                                    lineNumbers: "on",
                                    roundedSelection: false,
                                    scrollBeyondLastLine: false,
                                    automaticLayout: true,
                                  }}
                                />
                              )}
                            />
                          </div>
                          {errors.codeSnippets?.[language] && (
                            <p className="text-sm text-destructive">
                              {errors.codeSnippets[language].message}
                            </p>
                          )}
                        </div>

                        {/* Reference Solution */}
                        <div className="space-y-3">
                          <Label className="text-base font-medium flex items-center gap-2">
                            <CheckCircle2 className="h-4 w-4 text-green-500" />
                            Reference Solution
                          </Label>
                          <div className="border rounded-md overflow-hidden">
                            <Controller
                              name={`referenceSolutions.${language}`}
                              control={control}
                              render={({ field }) => (
                                <Editor
                                  height="300px"
                                  language={language.toLowerCase()}
                                  theme="vs-dark"
                                  value={field.value}
                                  onChange={field.onChange}
                                  options={{
                                    minimap: { enabled: false },
                                    fontSize: 14,
                                    lineNumbers: "on",
                                    roundedSelection: false,
                                    scrollBeyondLastLine: false,
                                    automaticLayout: true,
                                  }}
                                />
                              )}
                            />
                          </div>
                          {errors.referenceSolutions?.[language] && (
                            <p className="text-sm text-destructive">
                              {errors.referenceSolutions[language].message}
                            </p>
                          )}
                        </div>

                        {/* Examples */}
                        <div className="space-y-3">
                          <Label className="text-base font-medium">
                            Example
                          </Label>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label
                                htmlFor={`example-input-${language}`}
                                className="font-medium"
                              >
                                Input
                              </Label>
                              <Textarea
                                id={`example-input-${language}`}
                                {...register(`examples.${language}.input`)}
                                placeholder="Example input"
                                className="min-h-20 resize-y"
                              />
                              {errors.examples?.[language]?.input && (
                                <p className="text-sm text-destructive">
                                  {errors.examples[language].input.message}
                                </p>
                              )}
                            </div>
                            <div className="space-y-2">
                              <Label
                                htmlFor={`example-output-${language}`}
                                className="font-medium"
                              >
                                Output
                              </Label>
                              <Textarea
                                id={`example-output-${language}`}
                                {...register(`examples.${language}.output`)}
                                placeholder="Example output"
                                className="min-h-20 resize-y"
                              />
                              {errors.examples?.[language]?.output && (
                                <p className="text-sm text-destructive">
                                  {errors.examples[language].output.message}
                                </p>
                              )}
                            </div>
                            <div className="md:col-span-2 space-y-2">
                              <Label
                                htmlFor={`example-explanation-${language}`}
                                className="font-medium"
                              >
                                Explanation
                              </Label>
                              <Textarea
                                id={`example-explanation-${language}`}
                                {...register(
                                  `examples.${language}.explanation`
                                )}
                                placeholder="Explain the example"
                                className="min-h-24 resize-y"
                              />
                            </div>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </TabsContent>
                ))}
              </Tabs>

              {/* Additional Information */}
              <Card>
                <CardHeader>
                  <CardTitle className="text-lg flex items-center gap-2">
                    <Lightbulb className="h-5 w-5 text-amber-500" />
                    Additional Information
                  </CardTitle>
                </CardHeader>
                <CardContent className="space-y-6">
                  <div className="space-y-2">
                    <Label htmlFor="constraints" className="font-medium">
                      Constraints
                    </Label>
                    <Textarea
                      id="constraints"
                      {...register("constraints")}
                      placeholder="Enter problem constraints"
                      className="min-h-24 resize-y"
                    />
                    {errors.constraints && (
                      <p className="text-sm text-destructive">
                        {errors.constraints.message}
                      </p>
                    )}
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="hints" className="font-medium">
                      Hints (Optional)
                    </Label>
                    <Textarea
                      id="hints"
                      {...register("hints")}
                      placeholder="Enter hints for solving the problem"
                      className="min-h-24 resize-y"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="editorial" className="font-medium">
                      Editorial (Optional)
                    </Label>
                    <Textarea
                      id="editorial"
                      {...register("editorial")}
                      placeholder="Enter problem editorial/solution explanation"
                      className="min-h-32 resize-y"
                    />
                  </div>
                </CardContent>
              </Card>

              <CardFooter className="flex justify-end pt-4 border-t">
                <Button type="submit" size="lg" disabled={isLoading}>
                  {isLoading ? (
                    <div className="flex items-center gap-2">
                      <div className="h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
                      Creating...
                    </div>
                  ) : (
                    <div className="flex items-center gap-2">
                      <CheckCircle2 className="h-5 w-5" />
                      Create Problem
                    </div>
                  )}
                </Button>
              </CardFooter>
            </form>
          </CardContent>
        </Card>